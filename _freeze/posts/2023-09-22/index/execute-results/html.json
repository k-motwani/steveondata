{
  "hash": "2e27e0942d5c4a94135a02a774d05880",
  "result": {
    "markdown": "---\ntitle: \"Creating Confidence Intervals for a Linear Model in R Using Base R and the Iris Dataset\"\nauthor: \"Steven P. Sanderson II, MPH\"\ndate: \"2023-09-22\"\ncategories: [rtip, viz]\n---\n\n\n# Introduction\n\nLinear regression is a fundamental statistical technique used to model the relationship between a dependent variable and one or more independent variables. While fitting a linear model is relatively straightforward in R, it's also essential to understand the uncertainty associated with our model's predictions. One way to visualize this uncertainty is by creating confidence intervals around the regression line. In this blog post, we'll walk through how to perform linear regression and plot confidence intervals using base R with the popular Iris dataset.\n\n# About the Iris Dataset\n\nThe Iris dataset is a well-known dataset in the field of statistics and machine learning. It contains measurements of sepal length, sepal width, petal length, and petal width for three species of iris flowers: setosa, versicolor, and virginica. For our purposes, we'll focus on predicting petal length based on petal width for one of the iris species.\n\n# Loading the Data\n\nFirst, let's load the Iris dataset and take a quick look at its structure:\n\n```R\n# Load the Iris dataset\ndata(iris)\n```\n\nNow view it\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# View the first few rows of the dataset\nhead(iris)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  Sepal.Length Sepal.Width Petal.Length Petal.Width Species\n1          5.1         3.5          1.4         0.2  setosa\n2          4.9         3.0          1.4         0.2  setosa\n3          4.7         3.2          1.3         0.2  setosa\n4          4.6         3.1          1.5         0.2  setosa\n5          5.0         3.6          1.4         0.2  setosa\n6          5.4         3.9          1.7         0.4  setosa\n```\n:::\n:::\n\n\n# Fitting a Linear Model\n\nWe want to predict petal length (dependent variable) based on petal width (independent variable). To do this, we'll fit a linear regression model using the `lm()` function in R:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Fit a linear regression model\nmodel <- lm(Petal.Length ~ Petal.Width, data = iris)\n```\n:::\n\n\nNow that we have our model, let's move on to creating confidence intervals for the regression line.\n\n# Calculating Confidence Intervals\n\nTo calculate confidence intervals for the regression line, we'll use the `predict()` function with the `interval` argument set to \"confidence\":\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate confidence intervals\nconfidence_intervals <- predict(\n  model, \n  interval = \"confidence\", \n  level = 0.95\n)\n\n# View the first few rows of the confidence intervals\nhead(confidence_intervals)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n       fit      lwr      upr\n1 1.529546 1.402050 1.657042\n2 1.529546 1.402050 1.657042\n3 1.529546 1.402050 1.657042\n4 1.529546 1.402050 1.657042\n5 1.529546 1.402050 1.657042\n6 1.975534 1.863533 2.087536\n```\n:::\n:::\n\n\nThe `confidence_intervals` object now contains the lower and upper bounds of the confidence intervals for our predictions.\n\n# Creating the Plot\n\nWith the confidence intervals calculated, we can create a visually appealing plot to display our linear regression model and the associated confidence intervals:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a scatterplot of the data\nplot(\n  iris$Petal.Width, \n  iris$Petal.Length, \n  main = \"Linear Regression with Confidence Intervals\", \n  xlab = \"Petal Width\", ylab = \"Petal Length\"\n)\n\n# Add the regression line\nabline(model, col = \"blue\")\n\n# Add confidence intervals as shaded areas\npolygon(\n  c(iris$Petal.Width, rev(iris$Petal.Width)),\n  c(\n    confidence_intervals[, \"lwr\"], \n    rev(confidence_intervals[, \"upr\"])\n    ), \n  col = rgb(0, 0, 1, 0.2), border = NA)\n\n# Add a legend\nlegend(\n  \"topright\", \n  legend = c(\"Regression Line\", \"95% Confidence Interval\"), \n  col = c(\"blue\", rgb(0, 0, 1, 0.2)), \n  fill = c(NA, rgb(0, 0, 1, 0.2))\n)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\nIn this plot, we start by creating a scatterplot of the data points, then overlay the regression line in blue. The shaded area represents the 95% confidence interval around the regression line, giving us an idea of the uncertainty in our predictions.\n\nHere is a slightly different method, the confidence intervals:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate confidence intervals\nconf_intervals <- predict(model, interval = \"confidence\")\n```\n:::\n\n\nNow the plot:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a scatterplot\nplot(\n  iris$Petal.Width, \n  iris$Petal.Length, \n  main = \"Linear Model with Confidence Intervals\",\n  xlab = \"Petal Width\", \n  ylab = \"Petal Length\", \n  pch = 19, \n  col = \"blue\"\n)\n\n# Add the regression line\nabline(model, col = \"red\")\n\n# Add confidence intervals\nlines(\n  iris$Petal.Width, \n  conf_intervals[, \"lwr\"], \n  col = \"green\", \n  lty = 2\n)\nlines(\n  iris$Petal.Width, \n  conf_intervals[, \"upr\"], \n  col = \"green\", \n  lty = 2\n)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\n\n# Conclusion\n\nIn this blog post, we've demonstrated how to perform linear regression and plot confidence intervals using base R with the Iris dataset. Understanding and visualizing the uncertainty associated with our regression model is crucial for making informed decisions based on the model's predictions. You can apply these techniques to other datasets and regression problems to gain deeper insights into your data.\n\nLinear regression is just one of the many statistical techniques that R offers. As you continue your data analysis journey, you'll find R to be a powerful tool for exploring, modeling, and visualizing data.",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}