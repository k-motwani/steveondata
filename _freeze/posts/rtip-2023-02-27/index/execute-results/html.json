{
  "hash": "fe489ff4db7f4640a9f9d6ca974a405c",
  "result": {
    "markdown": "---\ntitle: \"Quickly Generate Nested Time Series Models\"\nauthor: \"Steven P. Sanderson II, MPH\"\ndate: \"2023-02-27\"\ncategories: [code, rtip, timeseries, autoarima]\n---\n\n\n# Introduction\n\nThere are many approaches to modeling time series data in R. One of the types of data that we might come across is a nested time series. This means the data is grouped simply by one or more keys. There are many methods in which to accomplish this task. This will be a quick post, but if you want a longer more detailed and quite frankly well written out one, then [this is a really good article](https://rpubs.com/alfado/purrr)\n\n# Exampmle\n\nLet's just get to it with a very simple example, the motivation here isn't to be all encompassing, but rather to just showcase it is possible for those who may not know it is.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(healthyR.data)\nlibrary(dplyr)\nlibrary(timetk)\n\nts_tbl <- healthyR_data |> \n  filter(ip_op_flag == \"I\") |> \n  select(visit_end_date_time, service_line, length_of_stay) |>\n  mutate(visit_end_date_time = as.Date(visit_end_date_time)) |>\n  group_by(service_line) |>\n  summarise_by_time(\n    .date_var = visit_end_date_time,\n    .by = \"month\",\n    los = mean(length_of_stay)\n  ) |>\n  ungroup()\n\nglimpse(ts_tbl)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 2,148\nColumns: 3\n$ service_line        <chr> \"Alcohol Abuse\", \"Alcohol Abuse\", \"Alcohol Abuse\",…\n$ visit_end_date_time <date> 2011-09-01, 2011-10-01, 2011-11-01, 2011-12-01, 2…\n$ los                 <dbl> 3.666667, 3.181818, 4.380952, 3.464286, 3.677419, …\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(forecast)\nlibrary(broom)\nlibrary(tidyr)\n\nglanced_models <- ts_tbl |> \n  nest_by(service_line) |> \n  mutate(AA = list(auto.arima(data$los))) |> \n  mutate(perf = list(glance(AA))) |> \n  unnest(cols = c(perf))\n\nglanced_models |>\n  select(-data)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 23 × 7\n# Groups:   service_line [23]\n   service_line                  AA         sigma logLik   AIC   BIC  nobs\n   <chr>                         <list>     <dbl>  <dbl> <dbl> <dbl> <int>\n 1 Alcohol Abuse                 <fr_ARIMA> 2.22  -241.   493.  506.   109\n 2 Bariatric Surgery For Obesity <fr_ARIMA> 0.609  -80.1  168.  178.    88\n 3 CHF                           <fr_ARIMA> 0.963 -152.   309.  314.   110\n 4 COPD                          <fr_ARIMA> 0.987 -155.   315.  320.   110\n 5 CVA                           <fr_ARIMA> 1.50  -201.   407.  412.   110\n 6 Carotid Endarterectomy        <fr_ARIMA> 6.27  -166.   335.  339.    51\n 7 Cellulitis                    <fr_ARIMA> 1.07  -163.   329.  335.   110\n 8 Chest Pain                    <fr_ARIMA> 0.848 -139.   281.  287.   110\n 9 GI Hemorrhage                 <fr_ARIMA> 1.21  -179.   361.  366.   111\n10 Joint Replacement             <fr_ARIMA> 1.65  -196.   396.  401.   102\n# … with 13 more rows\n```\n:::\n:::\n\n\nVoila!\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}