{
  "hash": "b37ec41482ed6ca58756393e52dfe321",
  "result": {
    "markdown": "---\ntitle: \"VBA to R and Back Again: Running R from VBA Pt 2\"\nauthor: \"Steven P. Sanderson II, MPH\"\ndate: \"2023-05-10\"\ncategories: [rtip, vba, excel]\n---\n\n\n# Introduction\n\nYesterday I posted on using VBA to execute R code that is written inside of the VBA script. So today, I will go over a simple example on executing an R script from VBA. So let's get into the code and what it does.\n\nFirst, let's look at the Function called \"Run_R_Script\". This function takes four arguments, where the first two are mandatory, and the last two are optional.\n\n*    sRApplicationPath - This is the path to the R application that you want to use to run your script. It is a required argument, and you need to provide the full path to the Rscript.exe file on your machine.\n\n*    sRFilePath - This is the path to the R script file that you want to execute. It is also a required argument, and you need to provide the full path to your R script file.\n\n*    iStyle - This is an optional argument that specifies how the script will be executed. By default, it is set to 1, which means that the script will run in a minimized window.\n\n*    bWaitTillComplete - This is another optional argument that specifies whether the function should wait until the script has finished running before returning control to the caller. By default, it is set to True, which means that the function will not return control until the script has completed execution.\n\nThe first line inside the Function defines two variables: sPath and shell.\n\n*    sPath - This variable will hold the path to the Rscript.exe file and the path to the R script file, which will be used later to run the script.\n\n*    shell - This variable is used to create an instance of the WScript.Shell object.\n\nNext, we wrap the R path with double quotations to avoid any issues with spaces in the path.\n\nAfter that, the script deletes Column A.\n\nThen, instead of using the \"shell.Run\" function, the code uses the \"shell.Exec\" function to execute the R script. This function returns an object that has a \"StdOut\" property, which contains the output of the script.\n\nThe output is then read using the \"ReadAll\" method, and the resulting string is split into an array using the \"Split\" function. The array is then iterated using a \"For\" loop, and each element of the array is written to Column A, starting at cell A1.\n\nFinally, the Function returns an Integer value, which is the result of the \"shell.Run\" function.\n\nThe Subroutine called \"Demo\" just demonstrates how to use the \"Run_R_Script\" function by calling it with the appropriate parameters.\n\n# Full Code\n\nHere is the R Script\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata.frame(\n    x = 1:10,\n    y = rnorm(10)\n)\n\nlist(\n    data.frame(\n        x = 1:10,\n        y = rnorm(10)\n    ),\n    data.frame(\n        x = 1:10,\n        y = rnorm(10)\n    )\n)\n```\n:::\n\n\nFull VBA\n\n```vb\nFunction Run_R_Script(sRApplicationPath As String, _\n                        sRFilePath As String, _\n                        Optional iStyle As Integer = 1, _\n                        Optional bWaitTillComplete As Boolean = True) As Integer\n\n    Dim sPath As String\n    Dim shell As Object\n\n    'Define shell object\n    Set shell = VBA.CreateObject(\"WScript.Shell\")\n\n    'Wrap the R path with double quotations\n    sPath = \"\"\"\" & sRApplicationPath & \"\"\"\"\n    sPath = sPath & \" \"\n    sPath = sPath & sRFilePath\n\n    'Delete Coumn A\n    Columns(\"A\").Delete\n    \n    'Get Result\n    result = shell.Exec(sPath).StdOut.ReadAll\n    result = Split(result, vbCrLf)\n    For i = 0 To UBound(result)\n        ActiveSheet.Range(\"A1\").Offset(i, 0).Value = result(i)\n    Next i\n    \nEnd Function\n\nSub Demo()\n    Dim iEerrorCode As Integer\n    iEerrorCode = Run_R_Script(\"C:\\Program Files\\R\\R-4.1.2\\bin\\x64\\Rscript.exe\", \"C:\\Users\\ssanders\\Desktop\\test.R\")\nEnd Sub\n```\n\n# Picture\n![Example Output, VBA, and R](Capture.PNG)\n\n# Reference\n[https://stackoverflow.com/a/54816881](https://stackoverflow.com/a/54816881)",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}